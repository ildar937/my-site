<script>
/* ===== –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–≤—Ç–æ–ø–æ–∏—Å–∫ ===== */

/* –ë–∞–∑–æ–≤—ã–µ –ø–∞–ø–∫–∏ (–≤—Å–µ –≤–∞—à–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã + –≤–ª–æ–∂–µ–Ω–Ω—ã–µ) */
const BASES = [
  "", "assets/", "asset/", "image/", "images/",
  "assets/images/", "assets/–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/",
  "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/", "–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/",
  "–∞–≤–∞—É—Ä—ã/", "–∞–≤—É–∞—Ä—ã/",
  "–∞–≤–∞—É—Ä—ã/–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/", "–∞–≤—É–∞—Ä—ã/–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/",
  "–∞–≤—É–∞—Ä—ã/–∞–≤—É–∞—Ä—ã/–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/",
  "–õ–∏—á–Ω—ã–π —Å–∞–π—Ç/", "–õ–∏—á–Ω—ã–π —Å–∞–π—Ç/assets/", "–õ–∏—á–Ω—ã–π —Å–∞–π—Ç/images/", "–õ–∏—á–Ω—ã–π —Å–∞–π—Ç/–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/",
  "–õ–∏—á–Ω—ã–π —Å–∞–π—Ç/–∞–≤—É–∞—Ä—ã/", "–õ–∏—á–Ω—ã–π —Å–∞–π—Ç/–∞–≤—É–∞—Ä—ã/–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/",
  "–õ–∏—á–Ω—ã–π —Å–∞–π—Ç/–∞–≤–∞—É—Ä—ã/", "–õ–∏—á–Ω—ã–π —Å–∞–π—Ç/–∞–≤–∞—É—Ä—ã/–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/",
  "–õ–∏—á–Ω—ã–π —Å–∞–π—Ç/–∞–≤—É–∞—Ä—ã/–∞–≤—É–∞—Ä—ã/–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/"
];

/* –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏–º—ë–Ω before/after */
function nameVariants(stem){
  const bases = [
    `${stem}-before`, `${stem}-after`,
    `${stem}_before`, `${stem}_after`,
    `${stem} before`, `${stem} after`
  ];
  const withIdx = [];
  bases.forEach(b => withIdx.push(b, `${b} (1)`, `${b} (2)`));
  const exts = [".jpg",".jpeg",".png",".webp"];
  const list = [];
  for(const b of withIdx) for(const e of exts) list.push(b+e);

  const cap = stem.charAt(0).toUpperCase()+stem.slice(1);
  list.push(`${cap}-before.jpg`, `${cap}-after.jpg`);
  return [...new Set(list)];
}

/* –ù–∞–±–æ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ */
const ITEMS = [
  { key:"krossovki", imgId:"krossovki-img", stem:"krossovki" },
  { key:"product",   imgId:"product-img",   stem:"product"   },
  { key:"headphones",imgId:"headphones-img",stem:"headphones"},
  { key:"watch",     imgId:"watch-img",     stem:"watch"     },
];

/* –¢–≤–æ—è –±–æ–ª—å—à–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ */
const CUSTOM_IMAGE_CANDIDATES = [
  "photo_2025-08-11_23-34-43.jpg13.jpg",
  "photo_2025-08-11_23-34-43.jpg",
  "–Ω–∞—É—à–Ω–∏–∫–∏.jpg","headphones.jpg"
];

/* –ü—Ä–∞–π—Å: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç DOCX ‚Üí PDF ‚Üí PNG */
const PRICE_FILES = [
  // DOCX
  "price-ildar.docx","price.docx","ai_design_site_ads.docx",
  "ai_design_site_ads 2.docx","ai_design_site_ads.docx 2.docx",
  "ai_design_site_ads (2).docx","ai_design_site_ads_2.docx",
  // PDF
  "price-ildar.pdf","price.pdf","price_a4.pdf",
  "ai_design_site_ads_simple.pdf","ai_design_site_ads_fixed.pdf","ai_design_site_ads.pdf",
  // PNG
  "price-ildar.png","price.png","price_a4.png"
];

const FOUND = {}; // key -> {base,before,after,imgId}

function setBadge(id, html, ok=true){
  const el = document.getElementById("badge-"+id);
  if(!el) return;
  el.innerHTML = (ok?'<span style="color:#18a058">‚úî</span> ':'<span style="color:#c22727">‚úñ</span> ')+html;
}

async function exists(url){
  const u = encodeURI(url);
  try{ const r = await fetch(u,{method:"HEAD",cache:"no-store"}); if(r.ok) return true; }catch(e){}
  try{ const r2 = await fetch(u,{method:"GET",cache:"no-store"}); return r2.ok; }catch(e){ return false; }
}
async function findBaseFor(file){
  for(const b of BASES){ if(await exists(b+file)) return b; }
  return null;
}
async function findAny(files){
  for(const f of files){
    const b = await findBaseFor(f);
    if(b) return {base:b,file:f};
  }
  return null;
}

/* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ */
async function initItem({key,imgId,stem}){
  const vars = nameVariants(stem);
  const beforeVars = vars.filter(v=>/before\./i.test(v));
  const afterVars  = vars.filter(v=>/after\./i.test(v));

  const before = await findAny(beforeVars);
  const img = document.getElementById(imgId);

  if(!before){
    img.alt = "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: " + (beforeVars[0] || (stem+"-before.jpg"));
    setBadge(key,"–ù–µ –Ω–∞–π–¥–µ–Ω–æ",false);
    return;
  }

  let afterFile = null;
  // —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º —Ç—É –∂–µ –±–∞–∑—É
  for(const f of afterVars){ if(await exists(before.base+f)){ afterFile = f; break; } }
  // –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –∏—â–µ–º –≤ –¥—Ä—É–≥–∏—Ö –±–∞–∑–∞—Ö
  if(!afterFile){
    const found = await findAny(afterVars);
    afterFile = found ? found.file : afterVars[0];
  }

  FOUND[key] = { base: before.base, before: before.file, after: afterFile, imgId };
  img.src = encodeURI(before.base + before.file) + "?v=" + Date.now();
  setBadge(key,"–ü—É—Ç—å: " + before.base + " ¬∑ —Ñ–∞–π–ª: " + before.file);
}

/* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ */
function showBefore(key){
  const s = FOUND[key]; if(!s) return;
  document.getElementById(s.imgId).src = encodeURI(s.base + s.before) + "?v=" + Date.now();
}
function showAfter(key){
  const s = FOUND[key]; if(!s) return;
  document.getElementById(s.imgId).src = encodeURI(s.base + s.after) + "?v=" + Date.now();
}

/* –ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ (–Ω–∞—É—à–Ω–∏–∫–∏) */
async function initCustom(){
  for(const f of CUSTOM_IMAGE_CANDIDATES){
    const b = await findBaseFor(f);
    if(b){
      const el = document.getElementById("custom-hero");
      if(el){ el.src = encodeURI(b+f) + "?v=" + Date.now(); }
      const badge = document.getElementById("badge-custom");
      if(badge) badge.innerHTML = '<span style="color:#18a058">‚úî</span> –ü—É—Ç—å: ' + b + ' ¬∑ —Ñ–∞–π–ª: ' + f;
      return;
    }
  }
  const badge = document.getElementById("badge-custom");
  if(badge) badge.innerHTML = '<span style="color:#c22727">‚úñ</span> –ö–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞';
}

/* –ü—Ä–∞–π—Å (DOCX/PDF/PNG) */
async function initPrice(){
  const link  = document.getElementById("price-link");
  const badge = document.getElementById("price-badge");
  for(const f of PRICE_FILES){
    const b = await findBaseFor(f);
    if(b){
      const url = encodeURI(b+f) + "?v=" + Date.now();
      link.href = url;
      const ext = f.split(".").pop().toUpperCase();
      link.textContent = (ext==="DOCX" ? "üìÑ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∞–π—Å (DOCX)" : "üìÑ –°–∫–∞—á–∞—Ç—å –ø—Ä–∞–π—Å ("+ext+")");
      link.style.pointerEvents = "auto";
      link.style.opacity = "1";
      badge.innerHTML = '<span style="color:#18a058">‚úî</span> –§–∞–π–ª: ' + b + f;
      return;
    }
  }
  link.removeAttribute("href");
  link.style.pointerEvents = "none";
  link.style.opacity = "0.6";
  badge.innerHTML = '<span style="color:#c22727">‚úñ</span> –ü—Ä–∞–π—Å –Ω–µ –Ω–∞–π–¥–µ–Ω. –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∏–º–µ–Ω–∞: ' + PRICE_FILES.join(" ¬∑ ");
}

/* –°—Ç–∞—Ä—Ç */
(async function(){
  await initCustom();
  for(const it of ITEMS){ await initItem(it); }
  await initPrice();
})();
</script>
