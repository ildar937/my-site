<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AI-дизайн • До/После</title>
  <style>
    :root{--bg:#fff;--fg:#111;--muted:#666;--panel:#f6f7f9;--btn:#111;--btnh:#333}
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--fg);line-height:1.6}
    header,footer{padding:26px 14px;text-align:center;background:var(--panel)}
    header h1{margin:0 0 6px}
    main{max-width:980px;margin:0 auto;padding:18px 14px}
    .pill{display:inline-block;background:#eef1f5;border-radius:999px;padding:8px 14px;color:#111;text-decoration:none;margin:0 6px}
    h2{text-align:center;margin:24px 0 10px}
    .card{display:flex;flex-direction:column;align-items:center;margin:28px 0}
    .card img{width:100%;max-width:880px;border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.12);min-height:180px;background:#f1f2f4;object-fit:cover}
    .btns{margin-top:10px}
    .btn{background:var(--btn);color:#fff;border:0;border-radius:9px;padding:9px 14px;margin:0 6px;cursor:pointer}
    .btn:hover{background:var(--btnh)}
    .muted{color:var(--muted);font-size:13px;margin-top:6px}
  </style>
</head>
<body>
  <header>
    <h1>AI-дизайн • До/После</h1>
    <div>Карточки, обложки, аватары • быстрый премиум-визуал</div>
    <p style="margin-top:10px">
      <a class="pill" href="https://t.me/foodfox_eldar_gainutdinov" target="_blank" rel="noopener">Telegram</a>
      <a class="pill" href="https://wa.me/79031696661?text=Здравствуйте!%20Хочу%20оформить%20заказ." target="_blank" rel="noopener">WhatsApp</a>
      <a class="pill" href="mailto:eldargainutdinoff@yandex.ru">E-mail</a>
    </p>
  </header>

  <main>
    <h2>Примеры работ</h2>
    <div id="samples"></div>
  </main>

  <footer>© Ильдар • AI-дизайн</footer>

  <script>
    /* Базы, где могут лежать картинки (включая кириллицу/вложения) */
    const BASES = [
      "", "assets/","asset/","image/","images/",
      "Изображения/","изображения/",
      "авауры/","авуары/",
      "авауры/Изображения/","авуары/Изображения/",
      "авуары/авуары/Изображения/",
      "Личный сайт/авуары/авуары/Изображения/"
    ];

    /* Проекты: headphones можно вообще не находить — карточка тогда не рисуется */
    const ITEMS = [
      { key:"krossovki", title:"Кроссовки", stem:"krossovki" },
      { key:"product",   title:"Товар",     stem:"product"   },
      { key:"headphones",title:"Наушники",  stem:"headphones"},
      { key:"watch",     title:"Часы",      stem:"watch"     }
    ];

    /* Варианты имён: -before/-after, _before/_after, (1), .jpg/.jpeg/.png */
    function nameVariants(stem){
      const bases = [
        `${stem}-before`, `${stem}-after`,
        `${stem}_before`, `${stem}_after`,
        `${stem} before`, `${stem} after`
      ];
      const withIdx = [];
      bases.forEach(b => withIdx.push(b, `${b} (1)`, `${b} (2)`));
      const exts = [".jpg",".jpeg",".png"];
      const list = [];
      for(const b of withIdx){ for(const e of exts){ list.push(b+e); } }
      const cap = stem.charAt(0).toUpperCase()+stem.slice(1);
      list.push(`${cap}-before.jpg`, `${cap}-after.jpg`);
      // Базовые короткие
      list.push(`${stem}-before.jpg`, `${stem}-after.jpg`);
      return [...new Set(list)];
    }

    /* Проверка существования изображения через <img> (без CORS/HEAD) */
    function testImage(url){
      return new Promise(res=>{
        const img = new Image();
        img.onload = ()=>res(true);
        img.onerror= ()=>res(false);
        img.src = encodeURI(url) + (url.includes("?")?"&":"?") + "v=" + Date.now();
      });
    }

    async function findFirstExisting(urls){
      for(const u of urls){ if(await testImage(u)) return u; }
      return null;
    }

    /* Пытаемся найти BEFORE в любой базе/варианте; AFTER — сначала в той же базе, иначе где угодно */
    async function resolvePair(stem){
      const vars = nameVariants(stem);
      const beforeVars = vars.filter(v=>/before\./i.test(v));
      const afterVars  = vars.filter(v=>/after\./i.test(v));

      // Все возможные URL для before: base + file
      const beforeUrls = [];
      for(const b of BASES) for(const f of beforeVars) beforeUrls.push(b+f);

      const beforeUrl = await findFirstExisting(beforeUrls);
      if(!beforeUrl) return null;

      // Найдём базу before (для компактности)
      const beforeBase = beforeUrl.slice(0, beforeUrl.lastIndexOf("/") + 1);
      // Попробуем after в той же базе
      const afterSameBase = await findFirstExisting(afterVars.map(f=>beforeBase+f));
      if(afterSameBase) return { baseBefore: beforeBase, before: beforeUrl.slice(beforeBase.length), baseAfter: beforeBase, after: afterSameBase.slice(beforeBase.length) };

      // Иначе — где угодно
      const afterUrls = [];
      for(const b of BASES) for(const f of afterVars) afterUrls.push(b+f);
      const afterUrl = await findFirstExisting(afterUrls);
      if(!afterUrl) return { baseBefore: beforeBase, before: beforeUrl.slice(beforeBase.length), baseAfter: beforeBase, after: afterVars[0] };

      const afterBase = afterUrl.slice(0, afterUrl.lastIndexOf("/") + 1);
      return { baseBefore: beforeBase, before: beforeUrl.slice(beforeBase.length), baseAfter: afterBase, after: afterUrl.slice(afterBase.length) };
    }

    /* Рендер карточки только если найдено хотя бы "до" */
    function renderCard({key,title}, pair){
      const wrap = document.getElementById("samples");
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img id="${key}-img" alt="${title}">
        <div style="margin-top:8px">${title}</div>
        <div class="btns">
          <button class="btn" data-key="${key}" data-which="before">До</button>
          <button class="btn" data-key="${key}" data-which="after">После</button>
        </div>
        <div id="badge-${key}" class="muted"></div>
      `;
      wrap.appendChild(card);

      const img = document.getElementById(`${key}-img`);
      img.dataset.baseBefore = pair.baseBefore;
      img.dataset.before     = pair.before;
      img.dataset.baseAfter  = pair.baseAfter;
      img.dataset.after      = pair.after;

      // Показать "до"
      img.src = encodeURI(pair.baseBefore + pair.before) + "?v=" + Date.now();

      // Бейдж пути (для контроля)
      const badge = document.getElementById(`badge-${key}`);
      badge.textContent = `Путь: ${pair.baseBefore} • файл: ${pair.before}`;
    }

    // Делегирование кликов по кнопкам
    document.addEventListener("click", (e)=>{
      if(!(e.target instanceof HTMLElement)) return;
      if(!e.target.matches(".btn[data-key]")) return;
      const key = e.target.dataset.key;
      const which = e.target.dataset.which;
      const img = document.getElementById(`${key}-img`);
      if(!img) return;
      const base = (which==="before") ? img.dataset.baseBefore : img.dataset.baseAfter;
      const file = (which==="before") ? img.dataset.before     : img.dataset.after;
      img.src = encodeURI(base + file) + "?v=" + Date.now();
    });

    // Инициализация: создаём карточки только для найденных наборов
    (async function(){
      for(const it of ITEMS){
        const pair = await resolvePair(it.stem);
        if(pair){ renderCard(it, pair); }
        // если не найдено (например, "Наушники") — просто пропускаем
      }
    })();
  </script>
</body>
</html>
